---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: tailscale-operator
spec:
  chartRef:
    kind: OCIRepository
    name: tailscale-operator
  interval: 1h
  values:
    apiServerProxyConfig:
      mode: "true"
    proxyConfig:
      defaultTags: "tag:k8s"
      defaultProxyClass: tailscale-homelab
    oauthSecretVolume:
      secret:
        secretName: &secret tailscale-operator-secret
    ingressClass:
      create: false
    operatorConfig:
      hostname: "tailscale-operator"
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          add:
            - NET_ADMIN
            - NET_RAW
          drop:
            - ALL
      podAnnotations:
        secret.reloader.stakater.com/reload: *secret
